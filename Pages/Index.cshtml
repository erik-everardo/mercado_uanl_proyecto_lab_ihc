@page
@model IndexModel

@if (Model.InicioSesion)
{
    Layout = "Dashboard";
    ViewData["Title"] = "Dashboard";
    @inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
        @functions{
            public string GetAntiXsrfRequestToken()
            {
                return Xsrf.GetAndStoreTokens(HttpContext).RequestToken;
            }
        }
    <script>
        var credencial = {usuario : "" + @Model.idUsuario, password : "" + @Model.password,__RequestVerificationToken:"@GetAntiXsrfRequestToken()"}
    </script>
    @*Estos divs son las pantallas principales, donde va el contenido. aparecen al dar clic en los botones*@
    @*de la barra izquierda*@
    <div id="principal">
        <h3>Principal</h3>
        <div id="productosRecientes_Div">
                <!--cards productos recientes abajo-->
                <div class="spinner-border text-primary" role="status">
                  <span class="sr-only">Cargando...</span>
                </div>
            </div>
        <div id="acaboDePublicar_Div">
            <!--cards productos publicados recientemente: abajo-->
            <div class="spinner-border text-primary" role="status">
              <span class="sr-only">Cargando...</span>
            </div>
        </div>
    </div>
    <div id="vender">
        <div class="accordion" id="vender_producto_form_acordeon">
            <div class="card">
                <div class="card-header" id="encabezado_c1">
                    <h2 class="mb-0">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#form">Nuevo producto para vender</button>
                    </h2>
                </div>
                <div id="form" class="collapse" data-parent="#vender_producto_form_acordeon">
                    <div class="card-body">
                        <form id="formulario_publicar_producto" asp-antiforgery="true">
                            <div class="form-group form-row">
                                <label for="nombre_prducto_nuevo" class="col-sm-3 col-md-2">El nombre del producto</label>
                                <input class="form-control col-sm-9 col-md-10" type="text" id="nombre_prducto_nuevo" name="Nombre"/>
                            </div>
                            <div class="form-group form-row">
                                <label class="col-2">Datos del producto</label>
                                <input type="number" id="precio_nuevo_producto" class="form-control col-2" placeholder="Precio en moneda nacional" name="precio"/>
                                <select class="custom-select col mx-2" id="seleccionar_categoria_nuevo_producto" name="Categoria">
                                    <option selected>Seleccionar categoria</option>
                                    <option value="dulces" name="categoria">Dulces y botanas</option>
                                    <option value="comida-rapida">Comida rápida</option>
                                    <option value="postres">Postres</option>
                                </select>
                            </div>
                            <div class="custom-file">
                                <input type="file" class="custom-file-input" id="elegir_foto_producto_nuevo"/>
                                <label class="custom-file-label" for="elegir_foto_producto_nuevo" data-browse="Elegir">Sube una foto de tu producto</label>
                            </div>
                            <div class="form-group my-1">
                                <label for="descripcion_producto_nuevo">Descripción extra del producto</label>
                                <textarea name="Descripcion" class="form-control" rows="5" id="descripcion_producto_nuevo" placeholder="Escribe todo lo que consideres que la gente debe saber de tu producto"></textarea>
                            </div>
                            <input type="hidden" value="@Model.idUsuario" name="id"/>
                            <input type="hidden" value="@Model.password" name="pass"/>
                            <div class="form-group d-flex justify-content-end">
                                <input id="boton_publicar_producto_nuevo" type="button" value="Publicar" class="form-control btn btn-success w-auto my-2"/>
                            </div>
                        
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="my-3 " id="mis_productos"></div>
    </div>
    <div id="calificaciones">
        <h3>Calificaciones y comentarios</h3>
    </div>
    <div id="ver_todo">
        
    </div>
    <div id="mejor_calificado">
        
    </div>
    <div id="por_categoria">
        
    </div>
    <div id="por_campus">
        
    </div>
    <div id="por_facultad">
        
    </div>
    @*Estas funciones de JS se ejecutan al cargar la pagina*@
    @section Scripts{
        <script>
            obtenerProductosRecienPublicados();
            obtenerProductosPublicosRecientes(@Model.idUsuario);
            document.getElementById("dropdown_nombre_usuario").innerHTML = "@Model.Nombre";
        </script>
    }
}
else
{
    ViewData["Title"] = "Home page";
    <h1 class="display-3">Mercado UANL</h1>
    <h4>La plataforma para estudiantes de la UANL que permite encontrar cosas que comprar</h4>
    <div class="jumbotron my-4">
        <h1 class="display-4">¿Te interesa?</h1>
        <p class="lead">Crea una cuenta para poder disfrutar del servicio</p>
        <hr class="my-4">
        <p>Con una cuenta puedes buscar productos para comprar y publicar los tuyos para venderlos.</p>
        <a class="btn btn-primary btn-lg" href="/signin" role="button">Crear cuenta</a>
        <p class="my-3">¿Ya tienes cuenta? <a href="/login">Inicia sesión</a></p>
    </div>
    @*Esto se ejecuta al cargar la pagina de inicio (sin haber iniciado sesion)*@
    <script>
        if(localStorage.getItem("sesion_iniciada") === "true"){
            window.location.href = "/login";
        }
    </script>
}
